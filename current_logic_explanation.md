# Текущая логика системы BullAware Monitor

## Как работает сейчас

### 1. Анализ трейдеров
- **Источник данных**: API BullAware получает данные топ-трейдеров eToro
- **Классификация**: Система автоматически разделяет трейдеров на:
  - **Дейтрейдеры**: высокая частота сделок (>2 в неделю), короткий период удержания (<30 дней)
  - **Долгосрочные инвесторы**: низкая частота сделок, длительный период удержания (>30 дней)

### 2. Скоринг трейдеров
**Для дейтрейдеров (веса):**
- Win Rate (25%) - процент прибыльных сделок
- Profit/Loss Ratio (20%) - соотношение прибыли к убыткам
- Max Drawdown (20%) - максимальная просадка (чем меньше, тем лучше)
- Consistency (15%) - стабильность результатов
- Risk Score (10%) - оценка риска (чем меньше, тем лучше)
- Trade Frequency (10%) - частота торговли

**Для долгосрочных инвесторов (веса):**
- CAGR (25%) - среднегодовая доходность
- Sharpe Ratio (20%) - доходность с поправкой на риск
- Max Drawdown (15%) - максимальная просадка
- Consistency (15%) - стабильность
- Copiers Count (10%) - количество копировщиков
- Holding Period (10%) - средний период удержания
- Diversification (5%) - диверсификация портфеля

### 3. Генерация сигналов (консенсус-алгоритм)
- **Анализ позиций**: Система анализирует текущие позиции топ-10 трейдеров каждого типа
- **Взвешенное голосование**: Каждый трейдер имеет вес на основе своего скора
- **Пороги консенсуса**:
  - Дейтрейдинг: 60% консенсус для сигнала, минимум 3 трейдера
  - Долгосрочные: 70% консенсус для сигнала, минимум 4 трейдера

### 4. Текущий вывод сигналов
**Что показывается сейчас:**
- Инструмент (например, NVDA, TSLA)
- Действие (BUY/SELL)
- Уровень уверенности (0-100%)
- Стратегия (дейтрейдинг/долгосрочная)
- Обоснование (текстовое описание)

## Что НЕ хватает для практического использования

### 1. Управление капиталом
- ❌ Нет рекомендаций по размеру позиции
- ❌ Нет учета доступного капитала пользователя
- ❌ Нет рекомендаций по риск-менеджменту

### 2. Конкретные суммы
- ❌ Не указывается, сколько долларов/евро инвестировать
- ❌ Нет расчета количества акций для покупки
- ❌ Нет учета текущих цен инструментов

### 3. Управление портфелем
- ❌ Нет отслеживания текущих позиций пользователя
- ❌ Нет рекомендаций по ребалансировке
- ❌ Нет stop-loss и take-profit уровней

## Предлагаемые улучшения

### 1. Добавить модуль управления капиталом
```python
class PositionSizer:
    def calculate_position_size(self, 
                              signal_confidence: float,
                              available_capital: float,
                              risk_per_trade: float = 0.02,  # 2% риска на сделку
                              strategy_type: str = 'day_trading'):
        # Расчет размера позиции на основе:
        # - Уверенности в сигнале
        # - Доступного капитала
        # - Допустимого риска
        # - Типа стратегии
```

### 2. Интеграция с ценами инструментов
```python
class PriceProvider:
    def get_current_price(self, symbol: str) -> float:
        # Получение текущей цены через Yahoo Finance API
        # или другой источник данных
        
    def calculate_shares_to_buy(self, 
                               symbol: str, 
                               investment_amount: float) -> int:
        # Расчет количества акций для покупки
```

### 3. Профиль пользователя
```python
class UserProfile:
    total_capital: float
    risk_tolerance: str  # 'conservative', 'moderate', 'aggressive'
    strategy_preference: str  # 'day_trading', 'long_term', 'mixed'
    current_positions: List[Position]
```

### 4. Улучшенные рекомендации
**Новый формат сигнала:**
```json
{
    "instrument": "NVDA",
    "action": "BUY",
    "confidence": 0.85,
    "current_price": 875.50,
    "recommended_investment": {
        "amount_usd": 1000,
        "shares": 1,
        "percentage_of_portfolio": 5.0
    },
    "risk_management": {
        "stop_loss": 831.73,  # -5% от цены входа
        "take_profit": 963.05,  # +10% от цены входа
        "max_loss_usd": 50.00
    },
    "reasoning": "5 из 7 топ долгосрочных трейдеров увеличили позиции в NVDA...",
    "supporting_traders": [
        {
            "username": "JeppeKirkBonde",
            "position_size": 8.18,
            "direction": "long"
        }
    ]
}
```

## Следующие шаги для реализации

1. **Добавить API для получения цен** (Yahoo Finance/Alpha Vantage)
2. **Создать модуль управления капиталом**
3. **Добавить профиль пользователя в БД**
4. **Улучшить алгоритм генерации сигналов**
5. **Обновить frontend для отображения новых данных**

Хотите, чтобы я реализовал эти улучшения?

